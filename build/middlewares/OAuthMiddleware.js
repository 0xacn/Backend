"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const OAuthUtil_1 = require("../utils/OAuthUtil");
exports.default = (request = 'login') => {
    return async (req, res, next) => {
        const { code } = req.query;
        const discord = new OAuthUtil_1.OAuth(code);
        try {
            await discord.validate(request);
            await discord.getUser();
            req.discord = discord;
            next();
        }
        catch (err) {
            res.status(500).json({
                success: false,
                error: err.message,
            });
        }
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT0F1dGhNaWRkbGV3YXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21pZGRsZXdhcmVzL09BdXRoTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLGtEQUEyQztBQUUzQyxrQkFBZSxDQUFDLFVBQWtCLE9BQU8sRUFBRSxFQUFFO0lBQ3pDLE9BQU8sS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsSUFBa0IsRUFBRSxFQUFFO1FBQzdELE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQzNCLE1BQU0sT0FBTyxHQUFHLElBQUksaUJBQUssQ0FBQyxJQUFjLENBQUMsQ0FBQztRQUUxQyxJQUFJO1lBQ0EsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2hDLE1BQU0sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBRXhCLEdBQUcsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1lBQ3RCLElBQUksRUFBRSxDQUFDO1NBQ1Y7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNWLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNqQixPQUFPLEVBQUUsS0FBSztnQkFDZCxLQUFLLEVBQUUsR0FBRyxDQUFDLE9BQU87YUFDckIsQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDLENBQUM7QUFDTixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0RnVuY3Rpb24sIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7IE9BdXRoIH0gZnJvbSAnLi4vdXRpbHMvT0F1dGhVdGlsJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IChyZXF1ZXN0OiBzdHJpbmcgPSAnbG9naW4nKSA9PiB7XHJcbiAgICByZXR1cm4gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XHJcbiAgICAgICAgY29uc3QgeyBjb2RlIH0gPSByZXEucXVlcnk7XHJcbiAgICAgICAgY29uc3QgZGlzY29yZCA9IG5ldyBPQXV0aChjb2RlIGFzIHN0cmluZyk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IGRpc2NvcmQudmFsaWRhdGUocmVxdWVzdCk7XHJcbiAgICAgICAgICAgIGF3YWl0IGRpc2NvcmQuZ2V0VXNlcigpO1xyXG5cclxuICAgICAgICAgICAgcmVxLmRpc2NvcmQgPSBkaXNjb3JkO1xyXG4gICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IGVyci5tZXNzYWdlLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59O1xyXG4iXX0=